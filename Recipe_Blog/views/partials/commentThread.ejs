<% comments.forEach(c => { %>

<div class="singleComment"
     data-level="<%= level %>">

    <!-- Comment Author and Timestamp -->
    <p>
        <strong><%= c.user_id %></strong>
        â€” <%= new Date(c.date_created).toLocaleString() %>
    </p>

    <!-- Comment Text -->
    <p><%= c.comment %></p>

    <!-- Reply Form (if user is logged in) -->
    <% if (currentUserId) { %>
        <form action="/commentReply" method="POST" class="replyForm" style="margin-top:0.3rem;">
            <input type="hidden" name="recipe_id" value="<%= recipeId %>">
            <input type="hidden" name="parent_id" value="<%= c.id %>">

            <textarea name="text" placeholder="Reply..." rows="1" style="width:90%;"></textarea>
            <button type="submit" class="saveBtn" style="margin-top:0.3rem;">Reply</button>
        </form>
    <% } %>

</div>

<!-- recursion: Render children of this comment -->
<% if (c.replies && c.replies.length > 0) { %>
    <%- include("commentThread", {
        comments: c.replies,
        parent: c.id,
        level: level + 1,
        recipeId,
        currentUserId
    }) %>
<% } %>

<% }) %>
